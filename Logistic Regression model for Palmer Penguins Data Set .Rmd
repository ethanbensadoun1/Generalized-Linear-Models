---
title: "Logistic Regression model for Palmer Penguins Data Set"
author: "Ethan Bensadoun"
date: "2024-08-15"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Part 1

```{r cars}
library(palmerpenguins) # You may need to install this package
library(tidyverse) # You may need to install this package
data(penguins)
penguins_complete <- penguins %>% drop_na()
view(penguins_complete)
```

## (a)

logit regression model can be modeled by the following:

```{r}
logit.penguins = glm(sex~body_mass_g,family=binomial,data=penguins_complete)
summary(logit.penguins)
```

As a result we can write out the logistic equation like this:

p = exp(-5.1625416 + 0.0012398*body_mass_g)/ (1 + exp(-5.1625416 + 0.0012398*body_mass_g))

## (b)

null hypothesis test:

From the summary output in part(a) of the problem we can see that the coefficient of the body_mass_g variable, Beta1, is 0.0012398.

Thus, we can set up the null and alternative hypotheses:

H0: Beta1 = 0

H1: Beta1 =!0

w/ a Type I error of alpha = 0.05 Thus, the confidence level of this test should be:\
(1-alpha)x100 =\> 95% confidence level

In addition, the p-value for the given variable Beta1 is: 7.10e-13

As a result, alpha \> p-value =\> 0.05 \> 7.10e-13

Thus, we can reject the null hypothesis because the p-value is less than given alpha. Thus, the result is statistically significant, i.e., we can be 95% confident that a higher body_mass_g is related to a specific sex of the penguin population.

## (c)

```{r}
Beta1.hat <- 0.0012398
exp.Beta1 <- exp(Beta1.hat)
exp.Beta1
# or we can just this function, which yields the same result:
exp(coef(logit.penguins)[2])
```


The penguin mass coefficient signifies the rise in log-odds of a penguin being male or the proportional alteration in the odds of a penguin being male itself when its body mass increases by one gram. According to the finding, a one-gram increase in a penguin's body mass results in a 0.00124 increase in the likelihood of it being male.

## (d)

```{r}
confint.default(logit.penguins)
# If we want the odds ratio, instead of the log-odds ratio, we simply need to exponentiation the estimate (or endpoints of the interval):
exp(confint.default(logit.penguins))
```

```{r}
penguins_complete = penguins_complete %>% mutate(phat_eh = predict(logit.penguins,type="response"))
# this adds a new column to our penguins_complete table with all the phat ()
```

```{r}
# the logistic equation, represents the fitted values on the curve (in this case for x=3500):
# phat = exp(Beta0.hat + Beta1.hat*body_mass_g)/ (1 + exp(Beta0.hat + Beta1.hat*body_mass_g))
Beta0.hat <- -5.1625416
Beta1.hat <- 0.0012398
phat = exp(Beta0.hat + Beta1.hat*3500)/ (1 + exp(Beta0.hat + Beta1.hat*3500))
phat
```

```{r}
exp(confint(logit.penguins,"body_mass_g"))
exp(confint.default(logit.penguins,"body_mass_g"))

```

## (e)

```{r}
library(pROC)
penguins.roc = roc(sex~fitted(logit.penguins),data=penguins_complete)
plot(penguins.roc)
```

Judging from the ROC curve displayed, we can conclude that the weight predictor offers only moderate predictive capability for determining the sex within the Palmer penguin dataset. If the curve were precisely along the diagonal line, we would consider the model to have predictive strength equivalent to random chance, like a coin flip. However, particularly at the extremes of penguin weights, employing weight as a predictor for sex appears to be a promising approach, indicated by the larger area under the curve.

## Part 2

```{r data, include=FALSE}
library(palmerpenguins)
library(tidyverse)
library(ggfortify)
library(MASS)
```

## a)
```{r a}
data(penguins)
penguins_complete <- penguins %>% drop_na()
multi.logit.penguins <- glm(sex ~ bill_depth_mm + bill_length_mm, family = binomial, data = penguins_complete)
# multiple logistic regression model fit with bill length and depth to sex
summary(multi.logit.penguins)
```


## b)
We observe a positive association between both bill length and depth and the response variable, sex. The coefficient for bill length indicates the increase in the log-odds of a penguin being male, or the proportional change to the odds of a penguin being male, with a one millimeter increase in bill length. Similarly, the coefficient for bill depth represents the increase in the log-odds of a penguin being male with a one millimeter change in bill depth. The model summary provides z-statistics regarding the significance of each covariate. The critical value for testing the significance of the covariate estimates is the following:




```{r b}
qt(0.05, nrow(penguins_complete)-2, lower.tail = FALSE)
qt(0.01, nrow(penguins_complete)-2, lower.tail = FALSE)
```
We can clearly see that both covariate z-values exceed both of these thresholds. Moreover, the corresponding p-values significantly fall below conventional significance levels of .05 or .01. Therefore, we can assert that the covariate values are statistically significant and that there is a plausible positive correlation between the length and depth of the Palmer penguins' bills and their likelihood of being male.



## c)

Now we can use stepAIC() in order to contrast the models and choose the "best" model:
``` {r c}
stepAIC(multi.logit.penguins)
stepAIC(glm(sex~bill_depth_mm, family=binomial, data=penguins_complete))
stepAIC(glm(sex~bill_length_mm, family=binomial, data=penguins_complete))

```


## d)

Plotting Pearson and deviance residuals:
```{r d}
ggplot(data=penguins_complete,
       aes(y=residuals(multi.logit.penguins,type="pearson"),x=bill_length_mm)) + 
  geom_point(size=2.5) + geom_hline(yintercept=0)  + ggtitle("Deviance Residuals v.s. Bill Length (mm)") + 
  geom_point(aes(y=residuals(multi.logit.penguins,type="deviance")), col="lightblue",size=2.5)

ggplot(data=penguins_complete, aes(y = residuals(multi.logit.penguins,type="pearson"), x = bill_depth_mm)) + 
  geom_point(size=2.5) + 
  geom_hline(yintercept=0) + 
  ggtitle("Deviance Residuals v.s. Bill Depth (mm)") + 
  geom_point(aes(y=residuals(multi.logit.penguins,type="deviance")), col="lightblue",size=2.5)

```

Overall, the data demonstrates a good fit in the vicinity of the sample mean, but there are notable outliers in both graphs that fall short of expectations. For instance, certain penguins with a specific bill length are expected by the model to be more likely male, yet they are not. This pattern is also observed in bill depth, albeit to a lesser degree, as some outliers are closer to the sample mean, warranting comparatively less concern.

The figures show that the 'clean' Palmer penguin data contains numerous data points that are poorly aligned. Particularly troubling are those data points that deviate significantly from the mean of either bill length or depth. These outliers are concerning as they exhibit a higher level of discrepancy than anticipated and are adjusted for their disproportionate influence.

## e)

```{r}
null.model <- glm(sex~1, family = binomial, data = penguins_complete)
n <- nrow(penguins_complete)

# Nagel and McFadden
Nagel = (1-((exp(logLik(null.model)))/exp(logLik(multi.logit.penguins))))^(2/n)/
    (1-exp(logLik(null.model)))^(2/n)
McFadden = 1 - logLik(multi.logit.penguins)/logLik(null.model)
print(Nagel)
print(McFadden)

```

The McFadden model fit statistic suggests that around 29.9% of the deviance in the data is accounted for by the model fit in (a). Consequently, a significant portion remains unexplained by the model, indicating it may not be a strong fit for the data.

The Nagelkerke model fit statistic is a measure used in logistic regression models to assess the overall fit of the model to the data. This statistic ranges from 0 to 1, with higher values indicating a better fit of the model to the data, in our case we have 1 as the result. It provides an estimate of the proportion of variation explained by the multi.logit.penguins model relative to the maximum possible variation, thus, the result is good. 
